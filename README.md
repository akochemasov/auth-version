# Автоматическое версионирование проекта

## Задача
Необходимо выкладывать проект в разные директории на cdn, т.е. версионнировать. Из-за особенностей реализации проекта и деплоя решено было использовать номер проекта из `package.json`. Как это сделать?
Вручную. Создаем ветку, отрываем `package.json` и меняем поле `version`. Далее сборщику передаем складывать статику проекта в папку с этим номером. Звучит легко и просто. Но как согласовать номера версий между другими членами команды? Идея, чтобы каждая новая ветка была минорной, или мажорной версией проекта. А каждый коммит в ней - это патч. [Семантическое версионирование](https://semver.org/lang/ru/). 
Может можно автоматизировать? Погуглив и поспрашивал опытных товарищей, нашел команду `npm version major|minor|path`. Создает тег (метки) с увеличившимся номером версии из `package.json`.
Также есть готовый пакет с дополнительными возможностями [version-bump-prompt](https://www.npmjs.com/package/version-bump-prompt). Выполняет ту же команды, но еще может сразу запушить изменения. 

## Проблема  
Два разработчика создают одновременно копии веток от мастера. У них у обоих в package.json номера совпадают http://joxi.ru/brRJodOUJaKQKr. Каждый выполняет команду `npm version minor`, у каждого номер версии увеличился и совпадает, так как номер версии изначально берется из package.json. Далее пушим на сервер. Если один из разработчиков раньше запушил свои изменения, то такой тег уже есть и возвращается ошибка. Нужно запускать до тех пор, пока не будет ошибки. Не удобно, не практично. И коммиты в ветке с неудавшимися тегами все равно фиксируются. Тоже не хорошо.  

## Решение
Брать последний тег с номером версии из origin, его увеличивать, обновлять в `package.json` и пушить  
Для этого написал bash-скрипт `.version`  

## Как пользоваться
`npm run version-major(minor|path)` - для увеличения мажорной (минорной или патча)  

## Дополнительно
Если вручную делать, то могут понадобится команды  
`npm run get-last-version` - получить последний тег с номером версии из origin  
`npm run show-versions-local` - получить список локальных тегов  
`npm run show-versions-origin` - посмотреть список тегов на origin  

Также приведу список полезных команд  
`git tag -d <tag name>` - удалить тег локально  
`git tag | xargs git tag -d` - удалить все теги локально  
`git fetch --tag` - скачать теги с origin
`git push --delete origin <tag name>` - удалить тег на origin  
